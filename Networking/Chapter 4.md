# Chapter 4 网络层

- 虚电路服务：只是一条连接，所有的分组都沿着这条路传送
- 数据报服务：数据报内部写好信息，根据信息来决定数据怎么走

## 网际协议IP

- 网络互连设备
  - 物理层中继系统：转发器
  - 数据链路层中继系统：网桥
  - 网络层中继系统：路由器
  - 网络层以上中继系统：网关

## IP地址

- 分类
  - A类：首位是0，Network ID：Host ID = 1:3
    - 1-126
    - 127用于表示localhost
    - 子网掩码：255.0.0.0
  - B类：首位是10，Network ID：Host ID = 2:2
    - 128.1-191.255
    - 子网掩码：255.255.0.0
  - C类：首位是110，Network ID：Host ID = 3:1
    - 192.0.1-223.255.255
    - 子网掩码：255.255.255.0
- 常用地址：
  - 127.0.0.1 本地环回地址
  - 169.254.0.0 自动分配地址
  - 保留私网地址
    - 10.0.0.0
    - 172.16.0.0-172.31.0.0
    - 192.168.0.0-192.168.255.0
- 子网掩码：网络位不变，主机位归零

## 子网划分（C类）

ex：192.168.0.1（255.255.255.0）划分两个子网

A子网：192.168.0.1-192.168.0.126

B子网：192.168.0.129-192.168.0.254

子网掩码往后移一位：255.255.255.128（128=10000000）

ex：192.168.0.1（255.255.255.0）划分四个子网

A子网：192.168.0.1-192.168.0.62（63是网段最后一个地址作为广播地址）

B子网：192.168.0.65-192.168.0.126

C子网：192.168.0.129-192.168.0.190

D子网：192.168.0.193-192.168.0.254

子网掩码往后移两位：255.255.255.192（192=11000000）

- 子网划分的规律：除2划分
- 点到点使用252（因为只有两个地址需要分配网段）
- 给计算机当地址不能全1不能全0

## 变长子网划分

ex：200台机器分别100，50，20，10在四个网段

100台子网掩码为255.255.255.128

50台子网掩码为255.255.255.192

20台子网掩码为255.255.255.224

10台子网掩码为255.255.255.240

## 子网划分（B类）

ex：172.16.0.0 子网掩码255.255.0.0 划分两个子网

A：172.16.0.1-172.16.127.254

B：172.16.128.1-172.16.255.254

## 超网

- 将两个子网的计算机划分在一个网段：变换子网掩码
- ex：255.255.255.0变成255.255.254.0 可以合并192.168.0.0和192.168.1.0

## IP地址和MAC地址

- 交换机基于MAC地址转发数据帧，路由器基于IP地址转发转发数据包
- 数据报在传输过程中不变，MAC地址需要重新封装
- MAC地址决定下一跳给谁，IP地址决定数据报的起点和终点

## ARP协议

- 将ip地址转换成物理地址
- RARP：逆ARP

## IP数据报

- 首部+数据构成
- 首部
  - 版本：4字节（ipv4/ipv6）
  - 首部长度：4字节
  - 区分服务：8字节，优先级判定字符
  - 总长度：16字节
  - **片偏移**：相应字节数/8，代表偏移量
  - **生存时间**：TTL，每过一个路由器TTL-1

## IP转发分组/路由

- 路由器在不同网段转发数据报
- 网络畅通条件：能去能回
- 沿途的路由器必须知道到目标/源网络的下一跳给哪个接口

